

pipeline {
    agent any

    stages {
        stage('dockerfile') {
            steps {

                sh'''
                docker build -t pacman-image1 .
                '''
            }
        }
        stage('test') {
            steps {
                sh '''
                npm test
                '''
            }
        }
        stage('image') {
            steps {
                sh '''
                docker tag pacman-image1
                '''
            }
        }

        stage('Deploy') {
            steps {
                withKubeConfig([credentialsId: 'kubeconfigpacman', serverUrl: 'https://skyered-devops.de:6443']) {
                sh 'kubectl apply -f pacman-deployment.yaml -n mazlumprojekt'
        }
      }


    }
}